<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0b1121;
            color: white;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #065f46;
        }

        .error {
            background: #7f1d1d;
        }

        .info {
            background: #1e3a8a;
        }

        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üß™ SaintsLND System Test</h1>

    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        // Test 1: Check if Stripe is loaded
        setTimeout(() => {
            if (typeof Stripe !== 'undefined') {
                addResult('‚úÖ Stripe.js loaded from CDN', 'success');
            } else {
                addResult('‚ùå Stripe.js NOT loaded', 'error');
            }
        }, 500);

        // Test 2: Check if window.stripe is initialized
        setTimeout(() => {
            if (window.stripe) {
                addResult('‚úÖ window.stripe initialized', 'success');
            } else {
                addResult('‚ùå window.stripe NOT initialized', 'error');
            }
        }, 2000);

        // Test 3: Check if preview system is loaded
        setTimeout(() => {
            if (window.previewSystem) {
                addResult('‚úÖ Preview system loaded', 'success');
                const templates = window.previewSystem.templates();
                addResult(`‚úÖ Found ${templates.length} templates`, 'success');

                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(templates.map(t => ({
                    name: t.name,
                    tier: t.tier,
                    slug: t.slug
                })), null, 2);
                results.appendChild(pre);
            } else {
                addResult('‚ùå Preview system NOT loaded', 'error');
            }
        }, 2000);

        // Test 4: Check if pricing cards exist
        setTimeout(() => {
            const pricingCards = document.querySelectorAll('.pricing-card');
            if (pricingCards.length > 0) {
                addResult(`‚úÖ Found ${pricingCards.length} pricing cards`, 'success');
            } else {
                addResult('‚ùå No pricing cards found', 'error');
            }
        }, 1000);

        // Test 5: Check if preview cards were injected
        setTimeout(() => {
            const previewCards = document.querySelectorAll('.preview-card');
            if (previewCards.length > 0) {
                addResult(`‚úÖ Found ${previewCards.length} preview cards injected`, 'success');
            } else {
                addResult('‚ö†Ô∏è No preview cards found - they should be injected by preview-system.js', 'error');
            }
        }, 3000);

        // Test 6: Check server connection
        fetch('http://localhost:4242/create-checkout-session', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ plan: 'test', amount: 100 })
        })
            .then(res => {
                if (res.ok) {
                    addResult('‚úÖ Server responding on port 4242', 'success');
                } else {
                    addResult(`‚ö†Ô∏è Server responded with status ${res.status}`, 'info');
                }
            })
            .catch(err => {
                addResult('‚ùå Server not responding on port 4242', 'error');
            });
    </script>

    <!-- Load the same scripts as index.html -->
    <script src="https://js.stripe.com/v3/"></script>
    <script type="module" src="/src/main.js"></script>
    <script src="/preview-system.js"></script>
</body>

</html>